/**     
 *                                                                
 *            .,,       .,:;;iiiiiiiii;;:,,.     .,,                   
 *          rGB##HS,.;iirrrrriiiiiiiiiirrrrri;,s&##MAS,                
 *         r5s;:r3AH5iiiii;;;;;;;;;;;;;;;;iiirXHGSsiih1,               
 *            .;i;;s91;;;;;;::::::::::::;;;;iS5;;;ii:                  
 *          :rsriii;;r::::::::::::::::::::::;;,;;iiirsi,               
 *       .,iri;;::::;;;;;;::,,,,,,,,,,,,,..,,;;;;;;;;iiri,,.           
 *    ,9BM&,            .,:;;:,,,,,,,,,,,hXA8:            ..,,,.       
 *   ,;&@@#r:;;;;;::::,,.   ,r,,,,,,,,,,iA@@@s,,:::;;;::,,.   .;.      
 *    :ih1iii;;;;;::::;;;;;;;:,,,,,,,,,,;i55r;;;;;;;;;iiirrrr,..       
 *   .ir;;iiiiiiiiii;;;;::::::,,,,,,,:::::,,:;;;iiiiiiiiiiiiri         
 *   iriiiiiiiiiiiiiiii;;;::::::::::::::::;;;iiiiiiiiiiiiiiiir;        
 *  ,riii;;;;;;;;;;;;;:::::::::::::::::::::::;;;;;;;;;;;;;;iiir.       
 *  iri;;;::::,,,,,,,,,,:::::::::::::::::::::::::,::,,::::;;iir:       
 * .rii;;::::,,,,,,,,,,,,:::::::::::::::::,,,,,,,,,,,,,::::;;iri       
 * ,rii;;;::,,,,,,,,,,,,,:::::::::::,:::::,,,,,,,,,,,,,:::;;;iir.      
 * ,rii;;i::,,,,,,,,,,,,,:::::::::::::::::,,,,,,,,,,,,,,::i;;iir.      
 * ,rii;;r::,,,,,,,,,,,,,:,:::::,:,:::::::,,,,,,,,,,,,,::;r;;iir.      
 * .rii;;rr,:,,,,,,,,,,,,,,:::::::::::::::,,,,,,,,,,,,,:,si;;iri       
 *  ;rii;:1i,,,,,,,,,,,,,,,,,,:::::::::,,,,,,,,,,,,,,,:,ss:;iir:       
 *  .rii;;;5r,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,sh:;;iri        
 *   ;rii;:;51,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.:hh:;;iir,        
 *    irii;::hSr,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,sSs:;;iir:         
 *     irii;;:iSSs:.,,,,,,,,,,,,,,,,,,,,,,,,,,,..:135;:;;iir:          
 *      ;rii;;:,r535r:...,,,,,,,,,,,,,,,,,,..,;sS35i,;;iirr:           
 *       :rrii;;:,;1S3Shs;:,............,:is533Ss:,;;;iiri,            
 *        .;rrii;;;:,;rhS393S55hh11hh5S3393Shr:,:;;;iirr:              
 *          .;rriii;;;::,:;is1h555555h1si;:,::;;;iirri:.               
 *            .:irrrii;;;;;:::,,,,,,,,:::;;;;iiirrr;,                  
 *               .:irrrriiiiii;;;;;;;;iiiiiirrrr;,.                    
 *                  .,:;iirrrrrrrrrrrrrrrrri;:.                        
 *                        ..,:::;;;;:::,,.                             
 */

/** 
 * .`"!~'';,;IEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE$$EEEEEEEE$$EEEEEEEEEEE$$EEEEEEEEEEEE$E$#*!~''~'>":
 * >1XYl]}1K%MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM@Wl}}}*X&]
 * I;1N@MMM@MMM@MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN]'
 * I;}MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM%l'
 * I;]NMM&..::..........:...::........:....:..::`....:..:....:.....:..:::`:``,,;,;'!!!!>>>>i111llll*l**YIXXF&@MMNl'
 * ]"$MM@]'NWW%#RK&&KK&&FF&&FF&&&&KRRKKKRR&K&&&XXXFFYX&FFXX&&&&KRKK&FXXYYXYIYIIXYX&YYXFFXX&&KRR&F&&XFKK#K&KR&WMM@#!
 * ENMMMM]'Fl}1+""!!>>!!"""~!~!!!"">>>>ii>"""""">!">!!!'~!~!~!!';'';;'',,,,,;;,,;'';;'~~~~"i+1}++11111i]1+}I&@MMMM@
 * WMMMMMl,Y}1i+>>>">>!~~">!!!!!"!~!!!!~~~!''~';,;';;~',,!',`;;;;,,``::.:::.::::``::```,,,;'~!"!!">">>"i">>lK@MMMMM
 * WMMMMM],I1++iiii>>>>"">i">">"""!""!!~'!~!"~''';',;,,`,+@`'','~';,``:````:.::::::::.::::`,';'~!>"~!"!>i">*K@MMMMM
 * WMMMMM],*1}}>>>>"!""""!"~~>!">!~~!~~!~'~'',,,`,;;;`;`."%I;`,;;~',`,`:`::``:::.`::::``::,,;''~~!~!!!!ii>+IKNMMMMM
 * WMMMMMl;*++i+>""~''~'">ii"~!}1"~~~!!>"~!!!';,;,;;',:1XXN*lX>,;;`,,,`:`,,,`:.:``.::.:;,``''""!'"!;'~~!">+Y#@MMMMM
 * WMMMMMl;*1+>i>"~''~"~>!~i"''~!i+>">>!~';;``,,',,',,iRi#Mi}1X};';`',`l"::`,``::``::`;`,``~'``!~~''''!""+>*R@MMMMM
 * WMMMMM],]1+>"~!>~""~'"!;>";"""!''~!!;,`'',,~~;,;,;}l]YM&lll}Ii':;,:~@K,:,,`:`:`,,,:;;';`';,,;;';''~~~"i"YE@MMMMM
 * WMMMMM],l+>>""!"'~!!;;~~~;,~~>i!!~';;'',~~;''~`,Xll*$MR~YI11#%X&:::"M+:,;`:`::``,,`;,,;`;';;;,,''''~>>!"IE@MMMMM
 * WMMMMM],li">!"~'"""~!""!~~'~;~">"!!!!~~!'';;;:>KI&l'N#IN>]Mi$%+}#1.lX`::,``;`;;;;~''``,;,'~'~!~~>"~'""!"IEMMMMMM
 * WMMMMM];]i"!!~'''!""',;;;!!';;'~>>>iiii>!"";"#RII!~F*1#%MW%}W@%Kl%FF":,;,``,;,,;`;,``:,',,,,,;'"~';'~~!"IEMMMMMM
 * WMMMMM],l1i!!';''!~!''~!~!>~~'~""!">!~!~"!:~$IlX"+WMiKW!>Y%"EMW++Y]R".``::,`,,;;,;`,,`,',;;;,`;;"';'~!""*$MMMMMM
 * WMMMMM];li>!!~'~~!~;'''~""~'!!!>!!';'',;``KWYl}+%&~"]IR>*#lF!~1*l*}l#$!:,`:`,`::'',,,``,'!~;,;';>~'~~~~"*EMMMMMM
 * WMMMMMl,*ii>"~~~~>"!>~;;~~;;~!"i!!!!;,;;iK#lY]lI>F#};F$il]>FN*i]]*}]}FMK:```:,`,;,;',,;;,,`;'!+""';;~!~"*E@MMMMM
 * WMMMMM];li>"!''~~!!!';;;'~~!"!!!;!!'!"!',`*$lI>XR+"+1Y@K"1]Y~*WlI>K]RK~:;;``,.::`;!~''',,`,;,;!~~''~!"""IE@MMMMM
 * WMMMMM],*i""!~';;;~>"!~!""!>!!">;;~>"">!~!,,MIKFi>+$!R$%E**i+@I>Y1WM;`:`;,,`,,``'''';;;;;;;;';!"~'~!~~""I#MMMMMM
 * WMMMMM];Ii>>!~;,'''~"iii!~""""'''!">';,``,;;,iFF}EEi!KN]WElK%E11*Fl',:..```````````,;;,,'!''!~''~''~~~~"*#@MMMMM
 * WMMMMM],I+i>!'';~';~;''~i+1}i>''"!~!"~;;,~;;`*E>@F>]"EN11l`l+1R%N#]>.`::`.:,~;;,;,`,,''';;;,,;;','~~''~!*R@MMMMM
 * WMMMMM],Y1++"!~;"!'!~~""iii1"i>";;'"';~';;;,}NNNEll>@%%i>;EXYI$&lW@%M@WI'`;;::,:`,,',```,,;';'''>!~!~~!~lR@MMMMM
 * WMMMMM];I}}1i"!!""""!!ii"~i]11>>~'"1i!i>!~',K@N@~.l@$N$>KY}lNN":.:;i>;:.;~'``,~',;,``,;;`;;;~!~~!>"'"!'!]KMMMMMM
 * WMMMMM]'Y]ll+>!!i>!~!++!!'~!>i!'"">i>;;';~'~::;>:;:`IY+IY}l%}:'!,,,:.`,,,`..,`;;,``;,,`::,`,''~~">"~!">!]&@MMMMM
 * WMMMMMl,RI]11>"">>i1}]i'"~~~>+i>11i!!;~,`''';,`::.`:.*MK1RW}:,.,,;,`,,,`::``:`::;;,;;,:::.`,!~">i>!~"!""lK@MMMMM
 * WMMMMMl,$RXl}">>>>>>}]1}i!"""i>>~~~"+';;~!~;;,,'.:.,`,.*W+..`,,.'';;,`:,,,,:,;,`;;,;;,````;,!'~!!!~~i>>"]&NMMMMM
 * WMMMMM];K&&Y++>i">"""i+"!~"i"!~'"!!>!,;'!~;,``::`:.:::::::;,..::`,,:`:`,;,::`',``:``,;;``:`,;;;''''!!~>"l&NMMMMM
 * WMMMMM]'#&X*11i+">>>>""">"!!~!!!~!~!!'~;';;;,,,,,,``:``,,,:`,,,,,;,`,,;;```,,;,,,,,;,,,`,,,`;''~~!!"""ii*FNMMMMM
 * WMMMMM]'RFXI}]1}1}111111++i+ii>>++i>>ii>""""~~~~'~''~!~~~!!!!!!!>""!~~~~!!!!"~!!""!!"!~~~!"!">>>i"!!ii""]X%MMMMM
 * WMMMMM],KYI*]l}lIYI*YI*IIYIY*IIIl]l*ll]]]]]l}}11}11}}11}}}]11}]]1+}l]]}}11}11}}}]l]1]]}}}l}]]]ll]111ii>>lYWMMMMM
 * WMMMMMl;&l]I*IYF##R#KKKKR#E#RRK&KRRKRRRK&&KKR&K&FK&X&XIX&&K&IIX&&*]RFKYFXYFFIXYI&&FIKFXXIY*XFXYFF*l]+i">*I%MMMMM
 * WMMMMMl;RI]llY&RW%%@%%WW$$WW%%%W$$$$%NN%%W$$%%%%#E$W$E#RE$EE#FF#W$YI%WEFKFE$F&K&EEKX$E&IX*&R&&R#&XYI}+>>**%MMMMM
 * WMMMMMl;Xl1}]YR$NNNNMMMMMM@NWW%@@@@%$$%@MMNN%M@M@%%$%NNW##NNN%R&N@EI$%%R&F&$YRRF$WKY%RIIYXR&F#$$KFX*+i>>**%MMMMM
 * WMMMMMl;Xl11*IK$@M@@@@@MMMMM@NNW$W%M@%WR$NMM@MNN%@@$E$W%WK&EW%%##%NR*EWWIYYK*Y&I&KI]#I]*I&Y*&EE#KXII+iii*]%MMMMM
 * WMMMMMl,X}}11lXKMMMMW@@N@M@@MMMMMWK&W@MM$&&EMM@@##E@K&#EW%RY#$E#Y&%$]*K#1}*Y]lY]IX1l*1ii*Il*KR#KXXIl1+>+*]%MMMMM
 * WMMMMMl'Xll1+i}YE%MM@M@N@@@N%%NN@MMMEKFE@MNR$@RRN$KXWRXYYR$#}IKRFlIEIi+lli1Ii>}11}"1i~">}lI*FKKXYXIl+++il}%MMMMM
 * WMMMMMl;Xll1+ii+&#$@M@%%MMMM%WW$EEWN@NWEK&EN@MR*lFE#K##F*}lX*i+]Xli+&l"'}"'>>!""">'!''!"1}+}XXYYXY*]1i>>]+WMMMMM
 * WMMMMMl,Fl}1>>++}I&RM@%W@MMMM@NWRKKRK#WNW$RRF$@NY+i1FYFKFIl11+i>i}+"1l+~""~'~;,;,;`,;;;'i">}lllIXIl]+>>+l+WMMMMM
 * WMMMMM],&*1}>>>>1}lY#%MM@N@MMMMMN$#RFK&#FE##lF@EE##&+i1F"IY]>"!'~!>>`!1',;;;',,``,,;;`,";;!!}]*I*Illii++]>WMMMMM
 * WMMMMMl'Y]1}i>>>1++}*FENM@M@@MMM@$W%##&F#FFRYl@N*I&KR&]~&+~""!''',,',``;`,;,````,,,,;,,',~'~+1]llI*}1+>1]"$MMMMM
 * WMMMMM];Yl1+i>!!ii+}}]IFNM@%W%N@MN*}K*YXX&Y}XiRN+i1]YY&#}FY!~',;,;;';,,:'"}YEERX";`:`;'~~;;'!">+lll}+i>+]"$MMMMM
 * WMMMMMl;Y1+1i"""">i>111}&#@MNWWWM@@IKN$E]+I*l]lWX+!"i1+>}}XF~,';;';,,``lWNMM@MMMM@EF:;';'~''!>>i]IY]]1>i}!EMMMMM
 * WMMMMM*;Y}}1>!!">"">i+}1]Y&EMM@N$WMN`}%@WWE@RK+X@R>"i}1i11~iF''i~!;;"F@NMMMMMMMMMMMM@l!;'~>!>"'!+]*]1+}}]'$MMMMM
 * WMMMMM*'Y]}+ii"!>>>>>>i+1}lYENMMW%%@+,}NRRKF@@*iM@MK1++i1}X1IKi;!~"!#MNMMMMMMMMMMMMMM$$K}!,~'!iilll1}i>i]'$MMMMM
 * WMMMMM*;Yl]++i>>>"!">"""+11lXK$@%$W@&";iWKWWWN@]#M@N*+]l+1+&XIRY~~~"M@MMM@@MMMMMMMMMNW$$i!li~~!>l*l+]1+1};$MMMMM
 * WMMMMM*;Yl]ii>"">"""~~!>>ii+lIFRMM$#K~~~%#YK%K#Ml&@M@R]1*1"'&N%#1"~}MMMMMM@NMMMMMMMMM@MN#i`'>~!>+11i1i+]};$MMMMM
 * WMMMMM*;Y*]+>!""!>>"!~!"">>+}lIXKN@@@>'~RNW#N@$$W$$E@MM@&F$&"IN@NR1iMNMMM@M%$@@@@MMMMMNWM$*>'+>i+i+}l]>+l;$M@MMM
 * WMMMMMI'I}11iiii"">>""""""">i1lI&FEN@&ii]&%NEMMN%%W$$N@MMNNNI"}E@M%KMMMMM@%%Fl&$W@MENMM@@@NR;!i+!>ii!!>i},EMMMMM
 * WMMMMMI;Fl++i+i+1i>!>>iiiiiii+}lXYXX%M%X*XX#$&WN%#X*K%@EK#@@MM$N@@MMMM@M@MM@$WRlK#%MMMM@WENN*'~]>11+i"ii},$MMMMM
 * WMMMMM*~F*}+i1i+1}l]i>ii1]+++1}lI**XFK%M$&&R$%@@I]lli~1$%#K&iilFMMMMMMMMMM@@%EF$%NMM@@MMM@%#NK>~~""!1+i++`EMMMMM
 * WMMMMMI!FI}++1++11}1}1111]}111}l}ll]*XF#MMN#%WMWRMM@M@$>M@NN@MK1lNMM@MM@@MMMl,"@W@@MMRW@$NN#]&K>>>i+i!">i`EMMMMM
 * WMMMMMI!F*}1+ii1++1+}]]]]IIll*]}l}11]lllF#%@%%N#M@MM@MMM+@NE$ENM~}@MM%MM@NEEW*IN@N%MNW%NWl*%l"*X>i1ii">>i`EMMMMM
 * WMMMMMI"Xl1+>i>>>>>"ii+}}l*]l]}]]11}}}ll]l*X@@NKMM@WNMMM+YN@EN@@X,}@NW%@@NNNMM%MMMMNMMK&1KIl+""}1iii+>""i`EMMMMM
 * WMMMMMIiX*}+1i>i+ii">">+++++}]ll]}}]l*Illl*lY&W@@@Rl>I$M#"RMN$%MMY;1MNE#WMMN%@@MM%#@%XI+N1'!&+'"X}1+i"!>i`EMMMMM
 * $MMMMMX+XYI+1i>i!"""~!""i>i"1}}}1111+}]*YIllllllWM@NEI+NN+1N%MMNMNY>WM%NMM@$@M$N@>X*Y~~1'#R!;}i~}1>""!~">:EMMMMM
 * WMMMMMXiF*]+11+1!!~~!!!~"">"+ii+11++"">>>i1]]lI**YFK@%1*@&+KMMMMNMMFFW@ENN@#W@NIYWK>"I]',;*Y;'>>!>ii"~!!>:EMMMMM
 * WMMMMMX1X]1+>+>i"!~~!>i>>"~!>ii>>>ii>>>i"""i]]*I*IF&WM%i]""Y@%N@$M@@IR#WMME$$IWRl*;I1+1i;;`;>"!>++i>"!!"i:EMMMMM
 * WMMMMMF}Y*]++>!"'~~!~!!~""">">>">>iiiii>>>>"+}}}}lIIWN@*R$K1NKRNW%WMXlRWlN@XMW&NY;+]`;"~';';}>"iiii>!~~>i:EMMMMM
 * WMMMMM&lY]]}+>i+!"!"';~!'!~~~!!!"!~!>"">iiii1]1+}}lI$@NR@MNINFIME*Y@@W##K$%#@@%%&K+'~~';;~~`>+>;]]i">!"">`EMMMMM
 * WMMMMM&lFl+>i!~~~!~~'''~'~!!~~!!"!!"~!>""">>>>+}]l*l#%N#&&X+R*$WE$1EM@%Wil$EKMMK##]~!';'!!~;;>]1"]l1i"!">:EMMMMM
 * WMMMMMK*Xl+>!"!!';''~~''''''!!""i>">"!">"">>i+1}i}l}E%N#]1i+Il@NK*FR@EE$lX@K#%@W#YX"'';;!~>">!>1+>"i"~!"":EMMMMM
 * WMMMMMK*&Yl}>>i"~~~;,;;''~!""!~~"""!!!!'"""!""!"!i}1RW%YE%&YX&%M&&E$WWElI@%WE$NM#RMN@%F1!!!!+""+}1i>i>~">:EMMMMM
 * WMMMMMRY&Yl1">!",,'';;'','!~~~!""""!!!>!">>ii">"++i1K%%1NM$*K}"N]1Y%%&+IMMMWWR@@MMMN~~'~"+++i]+!}11i>'~!>`#MMMMM
 * WMMMMMRYF*+>"!!",;',;;''~!~'~~~!!""!>>iii>>>>+i>">>>@@];MMEFXXYI+K@M$%MMMMMWREM@M$*"!!~!i>]I+}*}+1]1>!>!>:#MMMMM
 * WMMMMM#IYl}i"~~~;'~''''''';;';~!~!!!iii++iii+++i>~"*N$YXMM&KXWMXEMMN@WWMM%$WXMW@X!+i"!i1i11**11*}i>i+"!!>:#MMMMM
 * WMMMMM#XI]1>>>!~~';'''''''~'~''~'~~!!!>"+++i>>"!i}F%NMMMME}I}Y&YMM@MW%MM%K&N$$M@#KK#Xl*&KWRF&X*lF]i">>!>i:EMMMMM
 * %MMMMMEXI}>!"~~~~~~';,,'',';'',;'~~'""!"i>"">!""I#WRKM@M#YRl#EWNMMM@MMMMR&]R$#WWXI1!*$$$&F*ilF&*I**+}1>>+:EMMMMM
 * WMMMMMEFY1""!!!!~';,'',;;;;;'';''~~~!""">>>>!>1l$N%KlF@%*W%$$W@MMMMMMMM@FE#@%$W%1+X$$KI*+>I}*YF&*lIl1+ii+:EMMMMM
 * WMMMMMEFI+""'~~~''';;,`;;,;'';;;~~!!~~!"!>i>i}XENWN@%X]IM@$RW@@MMMMM%$RY*KFY$%@M%W@W*"~i]+}YlIYXY]}}}11++`EMMMMM
 * WMMMMME&I}i>~!!~;;;;,``,;'~;'~'';'~!!"i>">""lR%NWEE$MM@%%%NN@NWW#R&*1]+&WRIR#XFI&*FK*]">I}iI+*IIFII]]+>+i:#MMMMM
 * %MMMMM$KX]+>!!!~;;~,,,;,;';,;';;!'~!!"">!!>l$MMNW$KYYYK%WK&YF*Il"1*K@%MEEERF}]1]*+*YI*"!XX}}I+FIXYI]i>>>i:EMMMMM
 * WMMMMM$KFl+>>!!!',;;;,;;;;,;'''~'~!!!"""!1FWM@NNR*}]KEERY*lXXXY1RNMMW#%MMMM@N%RXl>*&*Il1FE}1FY*XYYI*i>""i`EMMMMM
 * WMMMMMWRXl}1!"!'~;;;;;;'';;';;;;'~~!""""F$@MNWEF&%M@@@@@MM@M%Y1X%MMMWWMMMMMM@M@@$&&X}FF]]ER}F&YIY*l]>>">i:#MMMMM
 * WMMMMMWRI}11>">~~'';;;;;';;';;'~'''~!>l&MM@@EX&$MNN@@@MMM@NW*1&WMMMMW@MM@@N%$#$N@@M@*I&Y*&WIXF&XF*lli>""i:EMMMMM
 * WMMMMMWRY]++!!~~;'!';;,,''`,;'';;;'!*#NMMMNKRMM@MM@@@%ERN#X#}EN%MM@NKNM@MMM@%$##EEWMNN$&YYEWYKKKFX*]>"!"i:EM@MMM
 * WMMMMMWRY]++!!~!''~'~~''''';'~'''!1F@MMMW##%MMMM@MNRK$M%KMRX$@N@MM@NWM%$@@@%N%NNE#RK%@MM#&&NFF#$YYIl+>!!>:EMMMMM
 * WMMMMMW#I}ii>"~~';''''''';'''~~~X#@MMMMEE@MMMMMMMMNF***&MY*RMMMMMMNRK%$R&&&FR$N@@@%E&WMMM$&$EF&EFY*]>>!">:#MMMMM
 * WMMMMMW#I}ii>>>>!!!!!!~~'''~'!+&MMM@EKFE@MMMMMMM@MMMMNMM@NNMMMMWKK&XWW#F]*IF$ERX&$N@&XE@MM%#NR&R&**Ii"!!>`EMMMMM
 * WMMMMM%#I}ii+iii"!~~!~''~~~~*E@@%WEK$@MMMMMMMM@NN@MMMMNNMMMMMM#*YKK$E$EY$%M@l~+XW$$WN@@@MMMN@%R&KFIl>">"i:EMMMMM
 * WMMMMM%EI}ii+i>>>"!"~~!~~"+FM@%$KKENMMMMMMMMN%%NMMMM@N@MMMM@%X1*$$#$$NWNMMK}]E%@##$%N@MMMMM@%NWKKXll1">>1`EMMMMM
 * WMMMMM%E*}ii+1i>i"!!"">>*&WN%#FFNMMMMM@MMM@N%N@MMMMMN@MMMN$$&FWME$%M@MMM&IYRM@NER%MN@MMMMMM@$N@E#F*]i">ii:EMMMMM
 * WMMMMM%E*}++i+i>ii>>i}*XWN%$XK%MMMMMMMMM@NNNMMMMM@@@MMMM%W$W%@@%N@MMMMMW%@MMM@$#NN@M@MM@MMMN$W@WKF*}+ii+i:#MMMMM
 * WMMMMMW#*]1ii>+i1++}XFR%$#&R@MMMMMMM@@@%NN@MMMMMN@@@MMMN%%@@MMMMMMMMMMM@MMMM@M@@MM@MM@MMM@N@W$%NKF*}1+>++:#MMMMM
 * WMMMMMWRI]1>+i1+lYF#NMMN$$N@MMMM@NN@@N%%@MMMMMMM@MMM@N%W@M@MMMMMMMMMMMMMMMMMMMMMM@@@M@@@M@%@NWW%KFYli>>i+:EMMMMM
 * WMMMMMW#XIl1+}IFWN@M@%WW@@M@@MM@N@M@$$W@MMMMMMMMMMMMNNN@MMMMMMMMMMMMMMMMMMMMMMMM@@@@MN@@MW$@@W$W#FII1i>">:EMMMMM
 * WMMMMMW#X*l]&FR$NMMNWWN@@NN@M@@@M%$EW@MMMMMMMMMMMM@NNMMMMMMMMMMMMMMMMMMMMMMMMMM@N@MM@%NM@##N@N$$E&Y*1i>">:EMMMMM
 * $MMMMMWRI*I*Y&REM%E#N@@N@MMM@@M@RKR$MMMMMMMM@M@@MN%W@MM@MMMMMMMMMMMMMMMMMMMMMMN%NN@MW$N@%&R%@@WEEKFY}1>i>:EMMMMM
 * %MMMMM$RFXIl*XK#KK#WWWW%NNN%N$R&&#WN%%%%NNNN%W%NW$$WNN%%%%N%%%%%%%%%%%%%%%%%%W#R%%%%EE%NEF&EW%$#KXIll]+++`EMMMM@
 * $M@MMM$K&X*lIIIY&##RRRRRKKR&IlIXKR####RKRRRRRKKK&KKKKKKKRRKKKRRRKRRRKKRRRKKRFYYXK&&KXFRRFXY&KRRFXY*}+1i!i:#MMMMM
 * $MMMMM$RKX]]]l]*YYYIIIYYYY*}]l*Ill*IYIIII***II*****I*****II*****]lll]l***lll++}lll*l]l**]]]*IYXYl]}1>>>!":#MMMM%
 * ]!%MMME&RI]l]]}]+++++iii>"ii++++iiii11++iiii++++++++>>ii>>i>>>>>>>>iiii+i>>>!"""""">>i11+11+111}+++i>""~>:#MMM$~
 * I;l@MMWXFFXYII*Illll]]}}1+iiii>">"!!~~'';;,,,,,,,,,,```````````````,,````:```````````````,,`,,,,```````:`'EMMNl;
 * *'}MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM@N*~
 * *']MMMMMMMMM@MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNl'
 * l+FR&F&&W@MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM@MKFF&K#F"
 * ;}}~.:.`.`X@MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM%l:.:..~"lF
 */
import AskingType from '../../AskingType';
import Card from '../../Card';
import Game from '../../Game';
import ISkill from '../../ISkill';
import Player from '../../Player';
import RequireType from '../../RequireType';
import CardType from './../../CardType';
import Color from './../../Color';
import EquipType from './../../EquipType';
import GameEvent from './../../GameEvent';
import { GameSyncEvent } from './../../GameEvent';
import Phase from './../../Phase';
import Predefined from './../../Predefined';
import Room from './../../Room';
import Sex from './../../Sex';
import SkillType from './../../SkillType';
import Suit from './../../Suit';
import * as Util from './../../Util';
import Zone from './../../Zone';
export = () => {
    const pkg = Game.createPackage('std/card');
    // 基本牌
    pkg.createCardClass({
        name: 'Sha',
        tipName: '杀',
        type: CardType.Basic,
        enabled: (card: Card, player: Player): boolean =>
            !player.limitUseCount(card) || player.getFlag('useShaCount') < 1
        ,
        filterSelect: (card: Card, player: Player, selected: Player[], targets: Player[]): Player[] => {
            if (selected.length == 1 + player.extraMaxTargetCount(card))
                return [];
            else
                return targets.filter(e => e != player && (!e.limitDistance(card) || e.inAttackRange(player)));
        },
        selectCorrectly: (card: Card, player: Player, selected: Player[]): boolean =>
            selected.length > 0
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            await source.damage({ target, sourceCard: card });
        },
        init: (room: Room) => {
            room.events.on(GameEvent.PhaseBegin, async (player: Player, phase: Phase) => {
                player.setFlag('useShaCount', 0);
            });
            room.events.on(GameEvent.UseCard, async (card: Card, player: Player) => {
                if (card.class.name == 'Sha') {
                    let cnt = player.getFlag('useShaCount');
                    player.setFlag('useShaCount', cnt + 1);
                }
            });
        },
    });
    pkg.createAsking({
        name: 'Shan',
        param: {
            cardClassName: 'Shan',
        },
    });
    pkg.createCardClass({
        name: 'Shan',
        tipName: '闪',
        type: CardType.Basic,
        enabled: false,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            return true;
        },
        init: (room: Room) => {
            room.events.on(GameEvent.BeforeCardEffect, async (card: Card, source: Player | undefined, selected: Player[], targets: Player[], target?: Player) => {
                if (target && card.class.name == 'Sha') {
                    let { card: response, ret } = await target.askUseCard(
                        'Shan',
                        {
                            targets: card,
                            cause: card,
                            extra: {
                                source: source && source.seatID,
                                target: target.seatID,
                            },
                        },
                    );
                    if (ret) {
                        return {
                            effect: false,
                            counteractingCard: response,
                        };
                    } else {
                        return true;
                    }
                }
            }, -1);
        },
    });
    pkg.createAsking({
        name: 'Tao',
        param: {
            cardClassName: 'Tao',
        },
    });
    pkg.createCardClass({
        name: 'Tao',
        tipName: '桃',
        type: CardType.Basic,
        enabled: (card: Card, player: Player): boolean => player.wounded,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            await target.recover({ source, sourceCard: card });
        },
        init: (room: Room) => {
            room.events.on(GameEvent.Dying, async (dyingPlayer: Player, currentPlayer: Player, delta: number) => {
                return await currentPlayer.askUseCard(
                    'Tao',
                    {
                        targets: [dyingPlayer],
                        extra: {
                            delta,
                            dyingPlayer: dyingPlayer.seatID,
                            currentPlayer: currentPlayer.seatID,
                        },
                    },
                );
            });
        },
    });
    //锦囊牌
    //    普通锦囊
    pkg.createCardClass({
        name: 'WuZhongShengYou',
        tipName: '无中生有',
        type: CardType.Bag,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            await target.drawCards(2);
        },
    });
    pkg.createAsking({
        name: 'NanManRuQin',
        param: {
            cardClassName: 'Sha',
        },
    });
    pkg.createCardClass({
        name: 'NanManRuQin',
        tipName: '南蛮入侵',
        type: CardType.Bag,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] =>
            player.room.alivePlayers.filter(e => e != player)
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let response = await target.askRespondCard(
                'NanManRuQin',
                {
                    cause: card,
                    extra: {
                        source: source.seatID,
                        target: target.seatID,
                    },
                });
            if (!response) {
                await source.damage({ target, sourceCard: card });
            }
        },
    });
    pkg.createAsking({
        name: 'WanJianQiFa',
        param: {
            cardClassName: 'Shan',
        },
    });
    pkg.createCardClass({
        name: 'WanJianQiFa',
        tipName: '万箭齐发',
        type: CardType.Bag,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] =>
            player.room.alivePlayers.filter(e => e != player)
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let response = await target.askRespondCard(
                'WanJianQiFa',
                {
                    cause: card,
                    extra: {
                        source: source.seatID,
                        target: target.seatID,
                    },
                },
            );
            if (!response) {
                await source.damage({ target, sourceCard: card });
            }
        },
    });
    pkg.createCardClass({
        name: 'TaoYuanJieYi',
        tipName: '桃园结义',
        type: CardType.Bag,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] =>
            player.room.alivePlayers.filter(e => e.HP < e.maxHP)
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            await target.recover({ source, sourceCard: card });
        },
        init: (room: Room) => {
            room.events.on(GameEvent.BeforeCardEffect, async (card: Card, source: Player | undefined, selected: Player[], targets: Player[], target?: Player) => {
                if (card.class.name == 'TaoYuanJieYi' && target && !target.wounded)
                    return false;
            }, Infinity);
        },
    });
    pkg.createAsking({
        name: 'WuXieKeJi',
        param: {
            cardClassName: 'WuXieKeJi',
        },
    });
    pkg.createCardClass({
        name: 'WuXieKeJi',
        tipName: '无懈可击',
        type: CardType.Bag,
        enabled: false,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            return true;
        },
        init: (room: Room) => {
            room.events.on(GameEvent.BeforeCardEffect, async (card: Card, source: Player | undefined, selected: Player[], targets: Player[], target?: Player) => {
                if (card.class.type == CardType.Bag) {
                    let asker = target ? target : source;
                    let { player, card: response, ret } = await room.askUseCard(
                        'WuXieKeJi',
                        {
                            targets: card,
                            cause: card,
                            extra: {
                                causeCardClassName: card.class.name,
                                asker: asker && asker.seatID,
                            },
                        },
                    );
                    if (ret) {
                        return {
                            effect: false,
                            counteractingCard: response,
                        };
                    } else {
                        return true;
                    }
                }
            }, -1);
        },
    });
    pkg.createAsking({
        name: 'JueDou',
        param: {
            cardClassName: 'Sha',
        },
    });
    pkg.createCardClass({
        name: 'JueDou',
        tipName: '决斗',
        type: CardType.Bag,
        enabled: true,
        filterSelect: (card: Card, player: Player, selected: Player[], targets: Player[]): Player[] => {
            if (selected.length == 1 + player.extraMaxTargetCount(card))
                return [];
            else
                return targets.filter(e => e != player);
        },
        selectCorrectly: (card: Card, player: Player, selected: Player[]): boolean =>
            selected.length > 0
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let player: Player = target;
            while (true) {
                let src = player == target ? source : target;
                let response = await player.askRespondCard(
                    'JueDou',
                    {
                        cause: card,
                        extra: {
                            source: src.seatID,
                        },
                    },
                );
                if (response) {
                    player = player == target ? source : target;
                } else {
                    await src.damage({ target: player, sourceCard: card });
                    break;
                }
            }
        },
    });
    pkg.createAsking({
        name: 'GuoHeChaiQiao',
        param: {
            cardCount: 1,
        },
    });
    pkg.createCardClass({
        name: 'GuoHeChaiQiao',
        tipName: '过河拆桥',
        type: CardType.Bag,
        enabled: true,
        filterSelect: (card: Card, player: Player, selected: Player[], targets: Player[]): Player[] => {
            if (selected.length == 1 + player.extraMaxTargetCount(card))
                return [];
            else
                return targets.filter(e => e != player && e.hasZoneCard);
        },
        selectCorrectly: (card: Card, player: Player, selected: Player[]): boolean =>
            selected.length > 0
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let cards = await source.askSelectCardsInWindow(
                'GuoHeChaiQiao',
                {
                    cards: [...target.room.makeUnknownCards(target.hand.length), ...target.equipZoneCards, ...target.judgeZone],
                    extra: {
                        target: target.seatID,
                    },
                },
            );
            cards = cards.map(card => {
                if (card == target.room.unknownCard) {
                    let random = source.room.random(0, target.hand.length - 1);
                    return target.hand[random];
                } else {
                    return card;
                }
            });
            await source.discard(cards);
        },
    });
    pkg.createAsking({
        name: 'ShunShouQianYang',
        param: {
            cardCount: 1,
        },
    });
    pkg.createCardClass({
        name: 'ShunShouQianYang',
        tipName: '顺手牵羊',
        type: CardType.Bag,
        enabled: true,
        filterSelect: (card: Card, player: Player, selected: Player[], targets: Player[]): Player[] => {
            if (selected.length == 1 + player.extraMaxTargetCount(card))
                return [];
            else
                return targets.filter(e => e != player && (!e.limitDistance(card) || player.distanceTo(e) == 1) && e.hasZoneCard);
        },
        selectCorrectly: (card: Card, player: Player, selected: Player[]): boolean =>
            selected.length > 0
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let cards = await source.askSelectCardsInWindow(
                'ShunShouQianYang',
                {
                    cards: [...target.room.makeUnknownCards(target.hand.length), ...target.equipZoneCards, ...target.judgeZone],
                    extra: {
                        target: target.seatID,
                    },
                },
            );
            cards = cards.map(card => {
                if (card == target.room.unknownCard) {
                    let random = source.room.random(0, target.hand.length - 1);
                    return target.hand[random];
                } else {
                    return card;
                }
            });
            await source.getCards(cards);
        },
    });
    pkg.createCardClass({
        name: 'WuGuFengDeng',
        tipName: '五谷丰登',
        type: CardType.Bag,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] =>
            player.room.alivePlayers
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let selectedCard = await target.askSelectGlobalCardInWindow();
            await target.getCards([selectedCard]);
        },
        init: (room: Room) => {
            room.events.on(GameEvent.AfterSetTarget, async (card: Card, source: Player, selected: Player[], targets: Player[]) => {
                if (card.class.name !== 'WuGuFengDeng')
                    return;
                room.globalCards = await room.lighten(Zone.CardPile, targets.length);
                room.showGlobalCardsWindow(
                    '<font color=0xffd800>五谷丰登</font>',
                    room.globalCards,
                );
            });
            room.events.on(GameEvent.AfterUseCardEnd, async (card: Card) => {
                if (card.class.name !== 'WuGuFengDeng')
                    return;
                room.closeGlobalCardsWindow();
                let cards: Card[] = room.globalCards.filter(e => e.zone == Zone.Dispose);
                if (cards.length > 0)
                    room.moveCards({
                        fromZone: Zone.Dispose,
                        toZone: Zone.DiscardPile,
                        cards,
                    });
                room.globalCards = [];
            });
        },
    });
    pkg.createAsking({
        name: 'JieDaoShaRen',
        param: {
            cardClassName: 'Sha',
        },
    });
    pkg.createCardClass({
        name: 'JieDaoShaRen',
        tipName: '借刀杀人',
        type: CardType.Bag,
        enabled: true,
        filterSelect: (card: Card, player: Player, selected: Player[], targets: Player[]): Player[] => {
            if (selected.length == 2 * (1 + player.extraMaxTargetCount(card)))
                return [];
            else
                return selected.length % 2 == 0 ?
                    targets.filter(e => e != player && e.hasEquipType(EquipType.Arm)) :
                    targets.filter(e => e.inAttackRange(selected[selected.length - 1]));
        },
        selectCorrectly: (card: Card, player: Player, selected: Player[]): boolean => {
            if (!(
                selected.length > 0 &&
                selected.length % 2 == 0 &&
                selected.length <= 2 * (1 + player.extraMaxTargetCount(card))
            )) return false;
            let pairs = selected.reduce((arr: Player[][], player, i) => {
                if (i % 2 == 1)
                    arr.push([selected[i - 1], player]);
                return arr;
            }, []);
            return pairs.every(pair => {
                let [source, target] = pair;
                return (
                    source != player &&
                    source.hasEquipType(EquipType.Arm) &&
                    target.inAttackRange(source)
                );
            });
        },
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => {
            return targets.filter((e, i) => i % 2 == 0);
        },
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let i = selected.indexOf(target);
            let player = selected[i + 1];
            let response = await target.askUseCard(
                'JieDaoShaRen',
                {
                    targets: [player],
                    extra: {
                        source: source.seatID,
                        target: target.seatID,
                    },
                },
            );
            if (!response) {
                let arm = target.equipZone[EquipType.Arm];
                if (arm) {
                    await source.getCards([arm]);
                }
            }
        },
    });
    //    延时锦囊
    pkg.createCardClass({
        name: 'LeBuSiShu',
        tipName: '乐不思蜀',
        type: CardType.Bag,
        delay: true,
        enabled: true,
        filterSelect: (card: Card, player: Player, selected: Player[], targets: Player[]): Player[] => {
            if (selected.length == 1)
                return [];
            else
                return targets.filter(e => e != player);
        },
        selectCorrectly: (card: Card, player: Player, selected: Player[]): boolean =>
            selected.length == 1
        ,
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let result = await target.judge();
            if (result.suit != Suit.Heart) {
                target.playEffect('LeBuSiShu');
                await target.room.round.skipPhase(Phase.Play);
                return true;
            }
            return false;
        },
    });
    pkg.createCardClass({
        name: 'ShanDian',
        tipName: '闪电',
        type: CardType.Bag,
        delay: true,
        rotate: true,
        enabled: (card: Card, player: Player): boolean => !player.hasCardClassInJudgeZone('ShanDian'),
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        effect: async (card: Card, source: Player, selected: Player[], targets: Player[], target: Player) => {
            let result = await target.judge();
            if (result.suit == Suit.Spade && result.number >= 2 && result.number <= 9) {
                target.room.playSound('ShanDian');
                target.playEffect('ShanDian');
                await target.damaged({ n: 3, sourceCard: card });
                card.move({
                    fromZone: Zone.Dispose,
                    toZone: Zone.DiscardPile,
                });
                return true;
            } else {
                return false;
            }
        },
    });
    //装备牌
    pkg.createSkill({
        name: '$BaGuaZhen',
        type: SkillType.Lock,
        enabled: (player: Player) =>
            player.room.askPlayers.includes(player) &&
            player.room.askingMatch(AskingType.UseSkill, '$BaGuaZhen')
        ,
        init: (room: Room) => {
            room.require(RequireType.CardClass, 'Shan');
            let func = async (cardClassName: string, player: Player) => {
                if (player.hasSkill('$BaGuaZhen')) {
                    if (cardClassName == 'Shan') {
                        if (await player.askUseSkill('$BaGuaZhen')) {
                            await player.useSkill('$BaGuaZhen', true);
                            let result = await player.judge();
                            if (Game.getColor(result.suit) == Color.Red) {
                                let card = room.makeVirtualCard(cardClassName);
                                return card;
                            }
                        }
                    }
                }
            };
            room.events.on(GameEvent.NeedUseCard, async (cardClassName: string, player: Player, targets: Player[] | Card) => {
                return await func(cardClassName, player);
            });
            room.events.on(GameEvent.NeedRespondCard, async (cardClassName: string, player: Player) => {
                return await func(cardClassName, player);
            });
        },
    });
    pkg.createCardClass({
        name: 'BaGuaZhen',
        tipName: '八卦阵',
        type: CardType.Equip,
        equipType: EquipType.Armor,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$BaGuaZhen')
                    return player.hasEquip('BaGuaZhen');
            });
        },
    });
    Predefined.createPlusHorse(pkg, {
        DiLu: '的卢',
        JueYing: '绝影',
        ZhuaHuangFeiDian: '爪黄飞电',
    });
    Predefined.createMinusHorse(pkg, {
        ChiTu: '赤兔',
        DaYuan: '大宛',
        ZiXing: '紫骍',
    });
    pkg.createSkill({
        name: '$GuanShiFu',
        type: SkillType.Normal,
        enabled: (player: Player) =>
            player.room.askPlayers.includes(player) &&
            player.room.askingMatch(AskingType.UseSkill, '$GuanShiFu')
        ,
        minCardCount: 2,
        maxCardCount: 2,
        filterCard: true,
        init: (room: Room) => {
            room.events.on(GameEvent.CardBeCounteracted, async (player: Player | undefined, card: Card, selected: Player[], targets: Player[], target?: Player, counteractingCard?: Card) => {
                if (player && target && player.hasSkill('$GuanShiFu')) {
                    if (card.class.name == 'Sha' && counteractingCard && counteractingCard.class.name == 'Shan') {
                        let skillParam = await player.askUseSkill('$GuanShiFu', { target });
                        let { cards }: { cards: Card[] } = skillParam;
                        if (cards && cards.length == 2) {
                            await player.useSkill('$GuanShiFu', skillParam);
                            await player.discard(cards);
                            return true;
                        }
                    }
                }
            });
        },
    });
    pkg.createCardClass({
        name: 'GuanShiFu',
        tipName: '贯石斧',
        type: CardType.Equip,
        equipType: EquipType.Arm,
        attackRange: 3,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$GuanShiFu')
                    return player.hasEquip('GuanShiFu');
            });
        },
    });
    pkg.createSkill({
        name: '$FangTianHuaJi',
        type: SkillType.Lock,
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.CalcExtraMaxTargetCount, (player: Player, card: Card, n: number) => {
                if (player.hasSkill('$FangTianHuaJi')) {
                    if (card.class.name == 'Sha' && player.hand.length == 1 && card == player.hand[0]) {
                        player.syncUseSkill('$FangTianHuaJi');
                        return n + 2;
                    }
                }
            });
        },
    });
    pkg.createCardClass({
        name: 'FangTianHuaJi',
        tipName: '方天画戟',
        type: CardType.Equip,
        equipType: EquipType.Arm,
        attackRange: 4,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$FangTianHuaJi')
                    return player.hasEquip('FangTianHuaJi');
            });
        },
    });
    pkg.createSkill({
        name: '$ZhuGeLianNu',
        type: SkillType.Lock,
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.LimitUseCount, (player: Player, card: Card) => {
                if (player.hasSkill('$ZhuGeLianNu')) {
                    if (card.class.name == 'Sha') {
                        player.syncUseSkill('$ZhuGeLianNu');
                        return false;
                    }
                }
            });
        },
    });
    pkg.createCardClass({
        name: 'ZhuGeLianNu',
        tipName: '诸葛连弩',
        type: CardType.Equip,
        equipType: EquipType.Arm,
        attackRange: 1,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$ZhuGeLianNu')
                    return player.hasEquip('ZhuGeLianNu');
            });
        },
    });
    pkg.createAsking({
        name: '$QiLinGong',
        param: {
            cardCount: 1,
        },
    });
    pkg.createSkill({
        name: '$QiLinGong',
        type: SkillType.Normal,
        enabled: (player: Player) =>
            player.room.askPlayers.includes(player) &&
            player.room.askingMatch(AskingType.UseSkill, '$QiLinGong')
        ,
        init: (room: Room) => {
            room.events.on(GameEvent.Damage, async (player: Player, target: Player, n: number, sourceCard?: Card) => {
                if (player.hasSkill('$QiLinGong')) {
                    if (sourceCard && sourceCard.class.name == 'Sha') {
                        let horses: Card[] = [];
                        let horse: Card | undefined;
                        horse = target.equipZone[EquipType.PlusHorse];
                        if (horse)
                            horses.push(horse);
                        horse = target.equipZone[EquipType.MinusHorse];
                        if (horse)
                            horses.push(horse);
                        if (horses.length > 0 && await player.askUseSkill('$QiLinGong', { target })) {
                            await player.useSkill('$QinLinGong', async () => {
                                let cards = await player.askSelectCardsInWindow(
                                    '$QiLinGong',
                                    {
                                        cards: horses,
                                        extra: {
                                            target: target.seatID,
                                        },
                                    },
                                );
                                await player.discard(cards);
                            });
                        }
                    }
                }
            });
        },
    });
    pkg.createCardClass({
        name: 'QiLinGong',
        tipName: '麒麟弓',
        type: CardType.Equip,
        equipType: EquipType.Arm,
        attackRange: 5,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$QiLinGong')
                    return player.hasEquip('QiLinGong');
            });
        },
    });
    pkg.createSkill({
        name: '$QingGangJian',
        type: SkillType.Lock,
        init: (room: Room) => {
            room.events.on(GameEvent.AfterSetTarget, async (card: Card, source: Player, selected: Player[], targets: Player[]) => {
                if (card.class.name == 'Sha') {
                    let players = source.getFlag('QingGangJianIgnoreArmorPlayers');
                    if (source.hasSkill('$QingGangJian')) {
                        await source.useSkill('$QingGangJian', async () => {
                            players = players || [];
                            players.push(...targets.map(target => target.seatID));
                            players = Util.removeRepeat(players);
                            source.setFlag('QingGangJianIgnoreArmorPlayers', players);
                        });
                    } else {
                        if (players && players.length != 0)
                            source.setFlag('QingGangJianIgnoreArmorPlayers', undefined);
                    }
                }
            });
            room.syncEvents.on(GameSyncEvent.IgnoreArmor, (source: Player, target: Player) => {
                let players: number[] = source.getFlag('QingGangJianIgnoreArmorPlayers');
                if (players && players.some(e => e == target.seatID))
                    return true;
            });
        },
    });
    pkg.createCardClass({
        name: 'QingGangJian',
        tipName: '青釭剑',
        type: CardType.Equip,
        equipType: EquipType.Arm,
        attackRange: 2,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$QingGangJian')
                    return player.hasEquip('QingGangJian');
            });
        },
    });
    pkg.createAsking({
        name: '$QingLongYanYueDao',
        param: {
            cardClassName: 'Sha',
        },
    });
    pkg.createSkill({
        name: '$QingLongYanYueDao',
        type: SkillType.Normal,
        enabled: (player: Player) =>
            player.room.askPlayers.includes(player) &&
            player.room.askingMatch(AskingType.UseSkill, '$QingLongYanYueDao')
        ,
        init: (room: Room) => {
            room.events.on(GameEvent.CardBeCounteracted, async (player: Player | undefined, card: Card, selected: Player[], targets: Player[], target?: Player, counteractingCard?: Card) => {
                if (player && target && player.hasSkill('$QingLongYanYueDao')) {
                    if (card.class.name == 'Sha' && counteractingCard && counteractingCard.class.name == 'Shan') {
                        await player.useSkill('$QingLongYanYueDao', async () => {
                            await player.askUseCard(
                                '$QingLongYanYueDao',
                                {
                                    targets: [target],
                                },
                            );
                        });
                    }
                }
            });
        },
    });
    pkg.createCardClass({
        name: 'QingLongYanYueDao',
        tipName: '青龙偃月刀',
        type: CardType.Equip,
        equipType: EquipType.Arm,
        attackRange: 3,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$QingLongYanYueDao')
                    return player.hasEquip('QingLongYanYueDao');
            });
        },
    });
    pkg.createSkill({
        name: '$ZhangBaSheMao',
        type: SkillType.Normal,
        enabled: (player: Player) =>
            player.room.askPlayers.includes(player) && (
                player.room.askingMatch(AskingType.PlayCard) &&
                player.cardEnabled(player.room.makeVirtualCard('Sha')) || (
                    (
                        player.room.askingMatch(AskingType.UseCard) ||
                        player.room.askingMatch(AskingType.RespondCard)
                    ) &&
                    player.room.askingParam.cardClassName == 'Sha'
                )
            )
        ,
        minCardCount: 2,
        maxCardCount: 2,
        filterCard: (skill: ISkill, player: Player, selectedCards: Card[], cards: Card[]): Card[] => cards.filter(card => card.inHand),
        viewAs: (skill: ISkill, player: Player, cards: Card[], selected: Player[], skillParam: any) =>
            player.room.makeVirtualCard('Sha', cards)
        ,
        init: (room: Room) => {
            room.require(RequireType.CardClass, 'Sha');
        },
    });
    pkg.createCardClass({
        name: 'ZhangBaSheMao',
        tipName: '丈八蛇矛',
        type: CardType.Equip,
        equipType: EquipType.Arm,
        attackRange: 3,
        enabled: true,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$ZhangBaSheMao')
                    return player.hasEquip('ZhangBaSheMao');
            });
        },
    });
    pkg.createSkill({
        name: '*CiXiongShuangGuJian_target',
        type: SkillType.Normal,
        maxCardCount: 1,
        filterCard: (skill: ISkill, player: Player, selectedCards: Card[], cards: Card[]): Card[] =>
            cards.filter(card => card.inHand)
        ,
    });
    pkg.createSkill({
        name: '$CiXiongShuangGuJian',
        type: SkillType.Normal,
        enabled: (player: Player) =>
            player.room.askPlayers.includes(player) &&
            player.room.askingMatch(AskingType.UseSkill, '$CiXiongShuangGuJian')
        ,
        init: (room: Room) => {
            room.events.on(GameEvent.AfterSetTarget, async (card: Card, source: Player, selected: Player[], targets: Player[]) => {
                if (source.hasSkill('$CiXiongShuangGuJian')) {
                    if (card.class.name == 'Sha') {
                        for (let target of targets) {
                            if (source.sex != target.sex && source.sex != Sex.None && target.sex != Sex.None) {
                                if (await source.askUseSkill('$CiXiongShuangGuJian', { target })) {
                                    await source.useSkill('$CiXiongShuangGuJian', async () => {
                                        let response = await target.askUseSkill('*CiXiongShuangGuJian_target', { source });
                                        if (response) {
                                            await target.discard(response.cards);
                                        } else {
                                            await source.drawCards(1);
                                        }
                                    });
                                }
                            }
                        }
                    }
                }
            });
        },
    });
    pkg.createCardClass({
        name: 'CiXiongShuangGuJian',
        tipName: '雌雄双股剑',
        type: CardType.Equip,
        equipType: EquipType.Arm,
        attackRange: 2,
        enabled: true,
        filterSelect: false,
        filterTarget: (card: Card, player: Player, targets: Player[]): Player[] => [player],
        init: (room: Room) => {
            room.syncEvents.on(GameSyncEvent.HasSkill, (player: Player, skillName: string) => {
                if (skillName == '$CiXiongShuangGuJian')
                    return player.hasEquip('CiXiongShuangGuJian');
            });
        },
    });
};
